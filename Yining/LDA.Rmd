---
title: 'STAT 542: Final Project'
author: "Karthik Vasu (kvasu2), Yining Lu (yining13)"
date: 'Due: 05/05/2022'
theme: readable
output:
  pdf_document:
    toc: yes
    toc_depth: 2
bibliography: references.bib
header-includes:
  - \usepackage{amsmath}
---

```{r, echo=FALSE}
train = read.csv("dataset/fashion-mnist_train.csv")
test = read.csv("dataset/fashion-mnist_test.csv")
```

```{r}
Xtrain = train[,2:785]
Ytrain = train[,1]

Xtest = test[,2:785]
Ytest = test[,1]
```

# Summary Statistics

Data table

```{r, echo=FALSE}
table(Ytrain)
table(Ytest)
```

# Multi-class Classification Model

- We have learned several different models that can perform multi-class classification. In this question, choose two of them and properly tune these models. Report the overall classification error and provide sufficient information (table/figure and descriptions) to demonstrate the model fitting results.

- Many models we learned are only for binary classifications. Try to extend one of them to handle multi-class problems. You can either search the existing literature to implement the method (or use their packages) or write your own code based on an ideal you have. Clearly describe your method framework, demonstrate the results and compare that with the two previous models.

```{r}
library(MASS)
class_lda = lda(Xtrain, Ytrain)
```

```{r}
Ytest_pred_lda = predict(class_lda, Xtest)$class
# confusion matrix
confuse_lda = table(Ytest, Ytest_pred_lda)
# mis-classification rate
misclass_rate_lda = rep(NA, 10)
number = rep(NA, 10)
for (i in 1:10) {
  misclass_rate_lda[i] = 1 - confuse_lda[i,i]/sum(confuse_lda[,i])
}
class = 0:9
misclass_lda = cbind(class, round(misclass_rate_lda,3))
# overall mis-classification rate
overall_misclass_lda = mean(Ytest_pred_lda != Ytest)
confuse_lda
misclass_lda
overall_misclass_lda
```

```{r}
library(kernlab)
k = 1
index = list()
lsvm.fit = list()
svm.fit = list()
mXtrain = as.matrix(Xtrain)
for (i in 1:10) {
  index[[i]] = which(Ytrain == i-1)
}
for (i in 1:9) {
  for (j in (i+1):10) {
    ind = c(index[[i]], index[[j]])
    x = mXtrain[ind,]
    y = c(rep(1, length(index[[i]])), rep(0, length(index[[j]])))
    lsvm.fit[[k]] = ksvm(x, y, type="C-svc", kernel="vanilladot", C=10, scaled=c())
    svm.fit[[k]] = ksvm(x, y, type="C-svc", kernel="rbfdot", C=10, scaled=c())
    k = k+1
  }
}
lvote = list()
vote = list()
for (i in 1:45) {
  lvote[[i]] = predict(lsvm.fit[[i]], Xtest)
  vote[[i]] = predict(svm.fit[[i]], Xtest)
}
```

```{r}
Ytest_pred_svm = rep(NA, length(Ytest))
for (l in 1:length(Ytest)) {
  k = 1
  vote_list = c()
  for (i in 1:9) {
    for (j in (i+1):10) {
      if (vote[[k]][l] == 1)
        current_vote = i-1
      else
        current_vote = j-1
      vote_list = c(vote_list, current_vote)
      k = k + 1
    }
  }
  Ytest_pred_svm[l] = names(which.max(table(vote_list)))
}
# confusion matrix
confuse_svm = table(Ytest, Ytest_pred_svm)
# mis-classification rate
misclass_rate_svm = rep(NA, 10)
number = rep(NA, 10)
for (i in 1:10) {
  misclass_rate_svm[i] = 1 - confuse_svm[i,i]/sum(confuse_svm[,i])
}
class = 0:9
misclass_svm = cbind(class, round(misclass_rate_svm,3))
# overall mis-classification rate
overall_misclass_svm = mean(Ytest_pred_svm != Ytest)
confuse_svm
misclass_svm
overall_misclass_svm
```

```{r}
Ytest_pred_lsvm = rep(NA, length(Ytest))
for (l in 1:length(Ytest)) {
  k = 1
  vote_list = c()
  for (i in 1:9) {
    for (j in (i+1):10) {
      if (lvote[[k]][l] == 1)
        current_vote = i-1
      else
        current_vote = j-1
      vote_list = c(vote_list, current_vote)
      k = k + 1
    }
  }
  Ytest_pred_lsvm[l] = names(which.max(table(vote_list)))
}
# confusion matrix
confuse_lsvm = table(Ytest, Ytest_pred_lsvm)
# mis-classification rate
misclass_rate_lsvm = rep(NA, 10)
number = rep(NA, 10)
for (i in 1:10) {
  misclass_rate_lsvm[i] = 1 - confuse_lsvm[i,i]/sum(confuse_lsvm[,i])
}
class = 0:9
misclass_lsvm = cbind(class, round(misclass_rate_lsvm,3))
# overall mis-classification rate
overall_misclass_lsvm = mean(Ytest_pred_lsvm != Ytest)
confuse_lsvm
misclass_lsvm
overall_misclass_lsvm
```

```{r}
save.image(file ="RData/lda_svm.RData")
```