---
title: 'STAT 542: Final Project'
author: "Karthik Vasu (kvasu2), Yining Lu (yining13)"
date: 'Due: 05/05/2022'
theme: readable
output:
  pdf_document:
    toc: yes
    toc_depth: 2
bibliography: references.bib
header-includes:
  - \usepackage{amsmath}
---

```{r, echo=FALSE}
train = read.csv("dataset/fashion-mnist_train.csv")
test = read.csv("dataset/fashion-mnist_test.csv")
```

```{r, warning=F}
Xtrain = train[,2:785]
Ytrain = train[,1]
mXtrain = as.matrix(Xtrain)

Xtest = test[,2:785]
Ytest = test[,1]
```

```{r}
trainMean <- apply(Xtrain,2,mean)
trainSd <- apply(Xtrain,2,sd)

Xtest.sca <- sweep(sweep(Xtest, 2L, trainMean), 2, trainSd, "/")
```

# Summary Statistics

Data table

```{r, echo=FALSE}
table(Ytrain)
table(Ytest)
```

```{r, echo=FALSE}
library(plyr)
set.seed(1)
Xtrain = scale(Xtrain)
pca = princomp(Xtrain)
elbow = count(pca$sdev > 1.75)$freq[2]
X.pca = pca$scores[,1:elbow]
```

```{r}
library(kernlab)
k = 1
index = list()
svm.fit = list()
for (i in 1:10) {
  index[[i]] = which(Ytrain == i-1)
}
for (i in 1:9) {
  for (j in (i+1):10) {
    ind = c(index[[i]], index[[j]])
    x = X.pca[ind,]
    y = c(rep(1, length(index[[i]])), rep(0, length(index[[j]])))
    svm.fit[[k]] = ksvm(x, y, type="C-svc", kernel="rbfdot", C=10, scaled=c())
    k = k+1
    print(k)
  }
}
```

```{r}
Xtest.pca = predict(pca, Xtest.sca)[,1:elbow]
vote = list()
for (i in 1:45) {
  vote[[i]] = predict(svm.fit[[i]], Xtest.pca)
}
```

```{r}
Ytest_pred_svm = rep(NA, length(Ytest))
for (l in 1:length(Ytest)) {
  k = 1
  vote_list = c()
  for (i in 1:9) {
    for (j in (i+1):10) {
      if (vote[[k]][l] == 1)
        current_vote = i-1
      else
        current_vote = j-1
      vote_list = c(vote_list, current_vote)
      k = k + 1
    }
  }
  Ytest_pred_svm[l] = names(which.max(table(vote_list)))
}
# confusion matrix
confuse_svm = table(Ytest, Ytest_pred_svm)
# mis-classification rate
misclass_rate_svm = rep(NA, 10)
number = rep(NA, 10)
for (i in 1:10) {
  misclass_rate_svm[i] = 1 - confuse_svm[i,i]/sum(confuse_svm[,i])
}
class = 0:9
misclass_svm = cbind(class, round(misclass_rate_svm,3))
# overall mis-classification rate
overall_misclass_svm = mean(Ytest_pred_svm != Ytest)
confuse_svm
misclass_svm
overall_misclass_svm
```